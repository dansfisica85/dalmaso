<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DALMASO ‚Äî Gest√£o Escolar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet" />
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>

<!-- =============== TELA DE LOGIN =============== -->
<div id="login-screen" class="login-screen">
  <div class="login-container">
    <div class="login-header">
      <div class="login-logo">
        <i class="bi bi-mortarboard-fill"></i>
      </div>
      <h1>DALMASO</h1>
      <p>Sistema de Gest√£o Escolar</p>
    </div>
    <form id="login-form" class="login-form">
      <div class="mb-3">
        <label class="form-label text-white-50">Senha de Acesso</label>
        <div class="input-group">
          <span class="input-group-text bg-transparent border-end-0 text-white-50"><i class="bi bi-lock-fill"></i></span>
          <input type="password" class="form-control login-input" id="login-senha" placeholder="Digite a senha..." autofocus />
          <button type="button" class="btn btn-outline-light border-start-0" id="toggle-senha">
            <i class="bi bi-eye"></i>
          </button>
        </div>
      </div>
      <button type="submit" class="btn btn-primary w-100 login-btn">
        <i class="bi bi-box-arrow-in-right"></i> Entrar
      </button>
      <div id="login-erro" class="mt-3 text-center" style="display:none;">
        <span class="badge bg-danger px-3 py-2"><i class="bi bi-exclamation-triangle"></i> <span id="login-erro-msg"></span></span>
      </div>
    </form>
    <div class="login-footer">
      <small>Gest√£o Escolar &copy; 2025 ‚Äî Todos os direitos reservados</small>
    </div>
  </div>
</div>

<!-- =============== APP PRINCIPAL =============== -->
<div class="d-flex" id="wrapper" style="display:none !important;">
  <nav id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <i class="bi bi-mortarboard-fill"></i>
      <span>DALMASO</span>
    </div>
    <ul class="sidebar-nav">
      <li class="active" data-page="monitoramento">
        <i class="bi bi-speedometer2"></i> <span>Monitoramento</span>
      </li>
      <li data-page="inicio">
        <i class="bi bi-house-fill"></i> <span>In√≠cio</span>
      </li>
      <li data-page="alunos" data-require="admin">
        <i class="bi bi-people-fill"></i> <span>Alunos</span>
      </li>
      <li data-page="relatorios" data-require="admin">
        <i class="bi bi-graph-up"></i> <span>Relat√≥rios</span>
      </li>
      <li data-page="importar" data-require="admin">
        <i class="bi bi-cloud-upload-fill"></i> <span>Importar Dados</span>
      </li>
      <li data-page="turmas" data-require="admin">
        <i class="bi bi-collection-fill"></i> <span>Turmas</span>
      </li>
      <li data-page="calendario-pedagogico">
        <i class="bi bi-calendar3-event"></i> <span>Calend√°rio 2026</span>
      </li>
      <li data-page="alertas-whatsapp">
        <i class="bi bi-whatsapp"></i> <span>Alertas WhatsApp</span>
      </li>
    </ul>
    <div class="sidebar-footer">
      <div class="d-flex align-items-center justify-content-between">
        <small id="label-nivel-acesso" class="text-truncate"></small>
        <button class="btn btn-sm btn-outline-light" id="btn-logout" title="Sair">
          <i class="bi bi-box-arrow-right"></i>
        </button>
      </div>
      <small class="d-block mt-1">Gest√£o Escolar v3.0</small>
    </div>
  </nav>

  <main id="main-content" class="main-content">
    <button class="btn btn-sm btn-outline-secondary d-md-none mb-3" id="btnToggleSidebar">
      <i class="bi bi-list"></i>
    </button>

    <!-- =============== PAINEL DE MONITORAMENTO =============== -->
    <section id="page-monitoramento" class="page active">
      <!-- Cabe√ßalho do Painel -->
      <div class="monitor-header">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <div>
            <h2 class="page-title mb-0"><i class="bi bi-speedometer2"></i> Painel de Monitoramento</h2>
            <p class="text-muted mb-0 small" id="monitor-subtitulo">Vis√£o geral da frequ√™ncia escolar</p>
          </div>
          <div class="d-flex align-items-center gap-2">
            <span class="badge badge-fonte" id="monitor-fonte">
              <i class="bi bi-database"></i> <span id="monitor-fonte-label">Carregando...</span>
            </span>
            <span class="badge badge-fev-completo" id="badge-fev" style="display:none;">
              <i class="bi bi-check-circle-fill"></i> Fevereiro completo
            </span>
            <span class="badge bg-success pulse-badge" id="monitor-status">
              <i class="bi bi-circle-fill"></i> Ao vivo
            </span>
            <span class="text-muted small" id="monitor-ultima-atualizacao"></span>
            <button class="btn btn-sm btn-outline-primary" id="btn-atualizar-monitor" title="Atualizar">
              <i class="bi bi-arrow-clockwise"></i>
            </button>
            <button class="btn btn-sm btn-fullscreen" id="btn-fullscreen" title="Tela Inteira">
              <i class="bi bi-arrows-fullscreen"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Filtros do Monitoramento -->
      <div class="monitor-filtros">
        <!-- Abas de Per√≠odo -->
        <div class="monitor-tabs">
          <button class="monitor-tab active" data-periodo="diario">
            <i class="bi bi-calendar-day"></i> Di√°rio
          </button>
          <button class="monitor-tab" data-periodo="semanal">
            <i class="bi bi-calendar-week"></i> Semanal
          </button>
          <button class="monitor-tab" data-periodo="mensal">
            <i class="bi bi-calendar-month"></i> Mensal
          </button>
          <button class="monitor-tab" data-periodo="bimestral">
            <i class="bi bi-calendar3"></i> Bimestral
          </button>
          <button class="monitor-tab" data-periodo="anual">
            <i class="bi bi-calendar-range"></i> Anual
          </button>
        </div>

        <!-- Filtros de Turno e N√≠vel -->
        <div class="d-flex flex-wrap gap-2 align-items-center mt-2">
          <div class="monitor-filter-group">
            <label class="small text-muted me-1">Turno:</label>
            <select class="form-select form-select-sm monitor-select" id="filtro-turno">
              <option value="todos">Todos</option>
              <option value="manha">Manh√£</option>
              <option value="tarde">Tarde</option>
              <option value="noite">Noite</option>
            </select>
          </div>
          <div class="monitor-filter-group">
            <label class="small text-muted me-1">N√≠vel:</label>
            <select class="form-select form-select-sm monitor-select" id="filtro-nivel">
              <option value="todos">Todos</option>
              <option value="ensino_medio">Ensino M√©dio</option>
              <option value="ensino_medio_iftp">Ensino M√©dio IFTP</option>
              <option value="fundamental_final">Fundamental (Anos Finais)</option>
            </select>
          </div>
          <div class="monitor-filter-group">
            <label class="small text-muted me-1">Data Ref.:</label>
            <input type="date" class="form-control form-control-sm monitor-select" id="filtro-data-ref" />
          </div>
        </div>
      </div>

      <!-- Cards Resumo -->
      <div class="row g-3 mb-4" id="monitor-cards">
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-turmas">
            <div class="monitor-card-icon"><i class="bi bi-collection-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="mc-turmas">--</span>
              <span class="monitor-card-label">Turmas</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-alunos">
            <div class="monitor-card-icon"><i class="bi bi-people-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="mc-alunos">--</span>
              <span class="monitor-card-label">Alunos</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-frequencia">
            <div class="monitor-card-icon"><i class="bi bi-check-circle-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="mc-frequencia">--%</span>
              <span class="monitor-card-label">Frequ√™ncia M√©dia</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-criticos">
            <div class="monitor-card-icon"><i class="bi bi-exclamation-triangle-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="mc-criticos">--</span>
              <span class="monitor-card-label">Alunos Cr√≠ticos</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Frequ√™ncia por Per√≠odo do Dia -->
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="monitor-periodo-card periodo-manha">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="bi bi-sunrise-fill fs-4"></i>
              <h6 class="mb-0">Manh√£</h6>
            </div>
            <div class="d-flex align-items-end justify-content-between">
              <span class="monitor-periodo-perc" id="mp-manha-perc">--%</span>
              <small class="text-muted" id="mp-manha-turmas">-- turmas</small>
            </div>
            <div class="monitor-progress mt-2">
              <div class="monitor-progress-bar bg-warning" id="mp-manha-bar" style="width:0%"></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="monitor-periodo-card periodo-tarde">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="bi bi-sun-fill fs-4"></i>
              <h6 class="mb-0">Tarde</h6>
            </div>
            <div class="d-flex align-items-end justify-content-between">
              <span class="monitor-periodo-perc" id="mp-tarde-perc">--%</span>
              <small class="text-muted" id="mp-tarde-turmas">-- turmas</small>
            </div>
            <div class="monitor-progress mt-2">
              <div class="monitor-progress-bar bg-info" id="mp-tarde-bar" style="width:0%"></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="monitor-periodo-card periodo-noite">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="bi bi-moon-stars-fill fs-4"></i>
              <h6 class="mb-0">Noite</h6>
            </div>
            <div class="d-flex align-items-end justify-content-between">
              <span class="monitor-periodo-perc" id="mp-noite-perc">--%</span>
              <small class="text-muted" id="mp-noite-turmas">-- turmas</small>
            </div>
            <div class="monitor-progress mt-2">
              <div class="monitor-progress-bar bg-primary" id="mp-noite-bar" style="width:0%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Gr√°ficos -->
      <div class="row g-3 mb-4">
        <div class="col-lg-8">
          <div class="monitor-chart-card">
            <h6 class="monitor-chart-title"><i class="bi bi-bar-chart-fill"></i> Frequ√™ncia por Turma</h6>
            <div id="chart-monitor-turmas" style="height:320px;"></div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="monitor-chart-card">
            <h6 class="monitor-chart-title"><i class="bi bi-pie-chart-fill"></i> Presen√ßa vs Aus√™ncia</h6>
            <div id="chart-monitor-pizza" style="height:320px;"></div>
          </div>
        </div>
      </div>

      <!-- Gr√°fico Temporal -->
      <div class="row g-3 mb-4">
        <div class="col-12">
          <div class="monitor-chart-card">
            <h6 class="monitor-chart-title"><i class="bi bi-graph-up"></i> Evolu√ß√£o da Frequ√™ncia no Per√≠odo</h6>
            <div id="chart-monitor-temporal" style="height:280px;"></div>
          </div>
        </div>
      </div>

      <!-- Tabela de Turmas -->
      <div class="monitor-chart-card mb-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h6 class="monitor-chart-title mb-0"><i class="bi bi-table"></i> Detalhamento por Turma</h6>
          <div class="d-flex gap-1">
            <button class="btn btn-sm btn-outline-secondary monitor-view-btn active" data-view="table"><i class="bi bi-list"></i></button>
            <button class="btn btn-sm btn-outline-secondary monitor-view-btn" data-view="grid"><i class="bi bi-grid-3x3-gap"></i></button>
          </div>
        </div>
        <!-- View: Tabela -->
        <div id="monitor-view-table" class="table-responsive">
          <table class="table table-hover mb-0" id="tabela-monitor">
            <thead>
              <tr>
                <th>Turma</th>
                <th>Turno</th>
                <th>N√≠vel</th>
                <th class="text-center">Alunos</th>
                <th class="text-center">Presen√ßas</th>
                <th class="text-center">Faltas</th>
                <th class="text-center">Dias Reg.</th>
                <th>Frequ√™ncia</th>
              </tr>
            </thead>
            <tbody id="corpo-tabela-monitor"></tbody>
          </table>
        </div>
        <!-- View: Grid -->
        <div id="monitor-view-grid" class="row g-2" style="display:none;"></div>
      </div>

      <!-- Alunos Cr√≠ticos -->
      <div class="monitor-chart-card mb-4">
        <h6 class="monitor-chart-title mb-3">
          <i class="bi bi-exclamation-triangle-fill text-danger"></i> Alunos em Situa√ß√£o Cr√≠tica (&lt; 75% de frequ√™ncia)
        </h6>
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Aluno</th>
                <th>RA</th>
                <th>Turma</th>
                <th class="text-center">Presen√ßas</th>
                <th class="text-center">Faltas</th>
                <th class="text-center">Total</th>
                <th>Frequ√™ncia</th>
              </tr>
            </thead>
            <tbody id="corpo-tabela-criticos"></tbody>
          </table>
        </div>
        <div id="monitor-sem-criticos" class="text-center text-muted py-4" style="display:none;">
          <i class="bi bi-check-circle text-success fs-2"></i>
          <p class="mt-2 mb-0">Nenhum aluno em situa√ß√£o cr√≠tica neste per√≠odo.</p>
        </div>
      </div>

      <!-- Admin: Ferramentas de Manuten√ß√£o -->
      <div class="monitor-chart-card mb-4" data-require="admin" id="admin-tools-section">
        <h6 class="monitor-chart-title mb-3">
          <i class="bi bi-tools text-warning"></i> Ferramentas de Administra√ß√£o
        </h6>
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-sm btn-outline-warning" id="btn-verificar-duplicados">
            <i class="bi bi-people"></i> Verificar Duplicados
          </button>
          <button class="btn btn-sm btn-outline-danger" id="btn-corrigir-duplicados" style="display:none;">
            <i class="bi bi-trash"></i> Corrigir Duplicados
          </button>
        </div>
        <div id="duplicados-resultado" class="mt-3"></div>
      </div>
    </section>

    <!-- IN√çCIO: Cards de Turmas -->
    <section id="page-inicio" class="page">
      <h2 class="page-title"><i class="bi bi-house-fill"></i> S√©ries / Turmas</h2>
      <p class="text-muted mb-3">Selecione uma turma para registrar frequ√™ncia no calend√°rio</p>

      <!-- Filtros de turno para a tela inicial -->
      <div class="d-flex flex-wrap gap-2 mb-3">
        <button class="btn btn-sm btn-outline-primary inicio-turno-btn active" data-turno="todos">Todos</button>
        <button class="btn btn-sm btn-outline-warning inicio-turno-btn" data-turno="manha"><i class="bi bi-sunrise"></i> Manh√£</button>
        <button class="btn btn-sm btn-outline-info inicio-turno-btn" data-turno="tarde"><i class="bi bi-sun"></i> Tarde</button>
        <button class="btn btn-sm btn-outline-dark inicio-turno-btn" data-turno="noite"><i class="bi bi-moon-stars"></i> Noite</button>
      </div>

      <div class="row g-3" id="grid-inicio"></div>
      <div id="inicio-vazio" class="text-center text-muted py-5" style="display:none;">
        <i class="bi bi-collection" style="font-size:3rem;"></i>
        <p class="mt-2">Nenhuma turma cadastrada. V√° em <strong>Turmas</strong> ou <strong>Importar</strong> para come√ßar.</p>
      </div>
    </section>

    <!-- CALEND√ÅRIO ANUAL -->
    <section id="page-calendario" class="page">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-outline-secondary btn-sm" id="btn-voltar-inicio"><i class="bi bi-arrow-left"></i></button>
          <h2 class="page-title mb-0"><i class="bi bi-calendar3"></i> <span id="titulo-calendario"></span></h2>
        </div>
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-sm btn-outline-primary" id="btn-ano-anterior"><i class="bi bi-chevron-left"></i></button>
          <span class="fw-bold fs-5" id="label-ano"></span>
          <button class="btn btn-sm btn-outline-primary" id="btn-ano-proximo"><i class="bi bi-chevron-right"></i></button>
        </div>
      </div>
      <div class="calendario-legenda mb-3">
        <span class="legenda-item"><span class="legenda-cor bg-dia-letivo"></span> Dia letivo</span>
        <span class="legenda-item"><span class="legenda-cor bg-dia-registrado"></span> Frequ√™ncia registrada</span>
        <span class="legenda-item"><span class="legenda-cor bg-dia-hoje"></span> Hoje</span>
        <span class="legenda-item"><span class="legenda-cor bg-dia-fds"></span> Fim de semana</span>
      </div>
      <div id="container-calendario"></div>
    </section>

    <!-- CHAMADA -->
    <section id="page-chamada" class="page">
      <div class="d-flex align-items-center gap-2 mb-3">
        <button class="btn btn-outline-secondary btn-sm" id="btn-voltar-calendario"><i class="bi bi-arrow-left"></i></button>
        <h2 class="page-title mb-0"><i class="bi bi-clipboard-check"></i> Chamada</h2>
      </div>
      <div class="card p-3 mb-3">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <div>
            <span class="badge bg-primary fs-6 me-2" id="badge-turma-chamada"></span>
            <span class="badge bg-secondary fs-6" id="badge-data-chamada"></span>
          </div>
          <div>
            <button class="btn btn-outline-secondary btn-sm me-1" id="btn-marcar-todos"><i class="bi bi-check-all"></i> Todos Presentes</button>
            <button class="btn btn-outline-warning btn-sm me-2" id="btn-desmarcar-todos"><i class="bi bi-x-circle"></i> Todos Ausentes</button>
            <button class="btn btn-success" id="btn-salvar-chamada"><i class="bi bi-check-circle"></i> Salvar Chamada</button>
          </div>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-hover" id="tabela-chamada">
          <thead>
            <tr>
              <th style="width:50px">N¬∫</th>
              <th>Nome do Aluno</th>
              <th>RA</th>
              <th class="text-center" style="width:110px">Presen√ßa</th>
              <th>Observa√ß√£o</th>
            </tr>
          </thead>
          <tbody id="corpo-tabela-chamada"></tbody>
        </table>
      </div>
    </section>

    <!-- =============== P√ÅGINA: ALERTAS WHATSAPP =============== -->
    <section id="page-alertas-whatsapp" class="page">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
        <h2 class="page-title mb-0"><i class="bi bi-whatsapp"></i> Alertas WhatsApp</h2>
        <div class="d-flex gap-2 flex-wrap">
          <div class="btn-group btn-group-sm" id="wpp-turno-btns">
            <button class="btn btn-outline-light active" data-turno="todos">Todos</button>
            <button class="btn btn-outline-warning" data-turno="manha"><i class="bi bi-sunrise"></i> Manh√£</button>
            <button class="btn btn-outline-primary" data-turno="tarde"><i class="bi bi-sun"></i> Tarde</button>
            <button class="btn btn-outline-info" data-turno="noite"><i class="bi bi-moon-stars"></i> Noite</button>
          </div>
          <div class="btn-group btn-group-sm" id="wpp-tipo-btns">
            <button class="btn btn-outline-light active" data-tipo="todos">Todos</button>
            <button class="btn btn-outline-danger" data-tipo="criticos"><i class="bi bi-exclamation-triangle"></i> Cr√≠ticos</button>
            <button class="btn btn-outline-secondary" data-tipo="sem_telefone"><i class="bi bi-telephone-x"></i> Sem Tel.</button>
          </div>
        </div>
      </div>

      <!-- Cards de resumo -->
      <div class="row g-3 mb-4" id="wpp-cards-resumo">
        <div class="col-6 col-lg-2">
          <div class="monitor-card card-alunos">
            <div class="monitor-card-icon"><i class="bi bi-people-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="wpp-total-alunos">--</span>
              <span class="monitor-card-label">Total Alunos</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-2">
          <div class="monitor-card card-criticos">
            <div class="monitor-card-icon"><i class="bi bi-exclamation-triangle-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="wpp-total-criticos">--</span>
              <span class="monitor-card-label">Cr√≠ticos (&lt;75%)</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-2">
          <div class="monitor-card card-frequencia">
            <div class="monitor-card-icon"><i class="bi bi-whatsapp"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="wpp-com-telefone">--</span>
              <span class="monitor-card-label">Com WhatsApp</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-2">
          <div class="monitor-card card-turmas">
            <div class="monitor-card-icon"><i class="bi bi-telephone-x-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="wpp-sem-telefone">--</span>
              <span class="monitor-card-label">Sem Telefone</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-2">
          <div class="monitor-card" style="border-left:4px solid #f59e0b;">
            <div class="monitor-card-icon"><i class="bi bi-eye-fill"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="wpp-total-atencao">--</span>
              <span class="monitor-card-label">Aten√ß√£o (75-80%)</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-2">
          <div class="monitor-card" style="border-left:4px solid #ef4444;">
            <div class="monitor-card-icon"><i class="bi bi-building-exclamation"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="wpp-turmas-criticas">--</span>
              <span class="monitor-card-label">Turmas Cr√≠ticas</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Info banner -->
      <div class="alert alert-info border-0 d-flex align-items-start gap-2 mb-4" style="background:rgba(0,212,170,0.1);border-left:4px solid #00d4aa !important;">
        <i class="bi bi-info-circle-fill fs-5" style="color:#00d4aa;"></i>
        <div>
          <strong>Como funciona:</strong> Este painel cruza dados de frequ√™ncia (SED) com telefones dos respons√°veis.
          Para envio autom√°tico via WhatsApp, √© necess√°rio configurar a <strong>Evolution API</strong> ou outro provedor.
          <a href="#" id="wpp-btn-config" class="text-decoration-underline" style="color:#00d4aa;">Configurar integra√ß√£o</a>
        </div>
      </div>

      <!-- Gr√°fico de turmas -->
      <div class="monitor-chart-card mb-4">
        <h6 class="monitor-chart-title"><i class="bi bi-bar-chart-fill"></i> Frequ√™ncia por Turma ‚Äî Alerta Visual</h6>
        <div id="wpp-chart-turmas" style="height:350px;"></div>
      </div>

      <!-- Tabela de alunos -->
      <div class="monitor-chart-card">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
          <h6 class="monitor-chart-title mb-0"><i class="bi bi-table"></i> Lista de Alunos para Alerta</h6>
          <div class="d-flex gap-2">
            <input type="text" class="form-control form-control-sm" id="wpp-busca-aluno" placeholder="Buscar aluno..." style="max-width:220px;">
            <button class="btn btn-sm btn-outline-success" id="wpp-btn-exportar" title="Exportar CSV">
              <i class="bi bi-download"></i> Exportar
            </button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-sm table-hover" id="wpp-tabela-alunos">
            <thead>
              <tr>
                <th>Status</th>
                <th>Aluno</th>
                <th>Turma</th>
                <th>Per√≠odo</th>
                <th>Respons√°vel</th>
                <th>WhatsApp</th>
                <th>Freq. Turma</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="wpp-tabela-body"></tbody>
          </table>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-3">
          <small class="text-muted" id="wpp-tabela-info">Carregando...</small>
          <nav><ul class="pagination pagination-sm mb-0" id="wpp-paginacao"></ul></nav>
        </div>
      </div>

      <!-- Modal de configura√ß√£o -->
      <div class="modal fade" id="modalConfigWhatsapp" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content bg-dark">
            <div class="modal-header border-secondary">
              <h5 class="modal-title"><i class="bi bi-gear"></i> Configurar Integra√ß√£o WhatsApp</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">URL da Evolution API</label>
                <input type="url" class="form-control" id="wpp-api-url" placeholder="https://sua-api.exemplo.com">
                <small class="text-muted">Endere√ßo do seu servidor Evolution API</small>
              </div>
              <div class="mb-3">
                <label class="form-label">API Key / Token</label>
                <input type="password" class="form-control" id="wpp-api-token" placeholder="Sua chave de API">
              </div>
              <div class="mb-3">
                <label class="form-label">Inst√¢ncia WhatsApp</label>
                <input type="text" class="form-control" id="wpp-instancia" placeholder="Nome da inst√¢ncia">
              </div>
              <div class="alert alert-warning border-0 mb-0">
                <i class="bi bi-exclamation-triangle"></i>
                <strong>Pr√©-requisitos:</strong>
                <ul class="mb-0 mt-1">
                  <li>Servidor com Evolution API rodando (Docker)</li>
                  <li>Chip de celular dedicado conectado via QR Code</li>
                  <li>Essas configura√ß√µes ficam salvas apenas no seu navegador</li>
                </ul>
              </div>
            </div>
            <div class="modal-footer border-secondary">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-success" id="wpp-btn-salvar-config">
                <i class="bi bi-check-circle"></i> Salvar Configura√ß√£o
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ALUNOS -->
    <section id="page-alunos" class="page">
      <h2 class="page-title"><i class="bi bi-people-fill"></i> Alunos</h2>
      <div class="row mb-3">
        <div class="col-md-4">
          <select class="form-select" id="filtro-turma-alunos"><option value="">Todas as turmas</option></select>
        </div>
        <div class="col-md-4">
          <input type="text" class="form-control" id="busca-alunos" placeholder="Buscar por nome, RA ou CPF..." />
        </div>
        <div class="col-md-4 text-end">
          <button class="btn btn-primary" id="btn-novo-aluno"><i class="bi bi-plus-circle"></i> Novo Aluno</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-hover" id="tabela-alunos">
          <thead><tr><th>N¬∫</th><th>Nome</th><th>RA</th><th>Turma</th><th>Nascimento</th><th>Sexo</th><th>A√ß√µes</th></tr></thead>
          <tbody id="corpo-tabela-alunos"></tbody>
        </table>
      </div>
      <div id="alunos-vazio" class="text-center text-muted py-5" style="display:none;">
        <i class="bi bi-inbox" style="font-size:3rem;"></i>
        <p class="mt-2">Nenhum aluno encontrado.</p>
      </div>
    </section>

    <!-- DETALHE DO ALUNO -->
    <section id="page-aluno-detalhe" class="page">
      <button class="btn btn-outline-secondary btn-sm mb-3" id="btn-voltar-alunos"><i class="bi bi-arrow-left"></i> Voltar</button>
      <div id="aluno-detalhe-conteudo"></div>
    </section>

    <!-- RELAT√ìRIOS -->
    <section id="page-relatorios" class="page">
      <h2 class="page-title"><i class="bi bi-graph-up"></i> Relat√≥rios</h2>
      <div class="row mb-3">
        <div class="col-md-4"><label class="form-label">Turma</label><select class="form-select" id="rel-turma"></select></div>
        <div class="col-md-3"><label class="form-label">M√™s</label><input type="month" class="form-control" id="rel-mes" /></div>
        <div class="col-md-3"><label class="form-label">Tipo</label>
          <select class="form-select" id="rel-tipo">
            <option value="frequencia">Frequ√™ncia Mensal</option>
            <option value="perfil">Perfil da Turma</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-primary" id="btn-gerar-relatorio"><i class="bi bi-bar-chart-fill"></i> Gerar</button>
        </div>
      </div>
      <div id="relatorio-conteudo"></div>
    </section>

    <!-- IMPORTAR -->
    <section id="page-importar" class="page">
      <h2 class="page-title"><i class="bi bi-cloud-upload-fill"></i> Importar Dados</h2>
      <div class="card p-4" style="max-width:600px;">
        <p class="text-muted mb-3">Importe dados de alunos a partir de um arquivo Excel (.xlsx) ou CSV (.csv) gerado pela extens√£o Chrome do SED.</p>
        <div class="mb-3"><label class="form-label">Arquivo</label>
          <input type="file" class="form-control" id="input-arquivo" accept=".xlsx,.xls,.csv" /></div>
        <button class="btn btn-primary" id="btn-importar"><i class="bi bi-upload"></i> Importar</button>
        <div id="importar-progresso" class="mt-3" style="display:none;">
          <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width:100%"></div></div>
          <small class="text-muted mt-1">Processando arquivo...</small>
        </div>
        <div id="importar-resultado" class="mt-3"></div>
      </div>
    </section>

    <!-- CALEND√ÅRIO PEDAG√ìGICO 2026 -->
    <section id="page-calendario-pedagogico" class="page">
      <h2 class="page-title"><i class="bi bi-calendar3-event"></i> Calend√°rio Pedag√≥gico 2026</h2>
      <p class="text-muted mb-3">Calend√°rio oficial da Secretaria da Educa√ß√£o do Estado de S√£o Paulo</p>
      
      <!-- Info cards -->
      <div class="row g-3 mb-4" id="cal-ped-info-cards">
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-turmas">
            <div class="monitor-card-icon"><i class="bi bi-calendar-check"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="cp-dias-letivos">--</span>
              <span class="monitor-card-label">Dias Letivos</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-alunos">
            <div class="monitor-card-icon"><i class="bi bi-calendar-x"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="cp-feriados">--</span>
              <span class="monitor-card-label">Feriados</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-frequencia">
            <div class="monitor-card-icon"><i class="bi bi-pencil-square"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="cp-avaliacoes">--</span>
              <span class="monitor-card-label">Avalia√ß√µes (AAP)</span>
            </div>
          </div>
        </div>
        <div class="col-6 col-lg-3">
          <div class="monitor-card card-criticos">
            <div class="monitor-card-icon"><i class="bi bi-trophy"></i></div>
            <div class="monitor-card-body">
              <span class="monitor-card-value" id="cp-olimpiadas">--</span>
              <span class="monitor-card-label">Olimp√≠adas</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Legenda -->
      <div class="cal-ped-legenda mb-4">
        <span class="legenda-item"><span class="legenda-cor" style="background:#ef4444;"></span> Feriado</span>
        <span class="legenda-item"><span class="legenda-cor" style="background:#a855f7;"></span> Recesso</span>
        <span class="legenda-item"><span class="legenda-cor" style="background:#22d3ee;"></span> Avalia√ß√£o (AAP)</span>
        <span class="legenda-item"><span class="legenda-cor" style="background:#facc15;"></span> Conselho</span>
        <span class="legenda-item"><span class="legenda-cor" style="background:#fb923c;"></span> Reuni√£o Pais</span>
        <span class="legenda-item"><span class="legenda-cor" style="background:#00d4aa;"></span> Fev. Completo</span>
        <span class="legenda-item"><span class="legenda-cor" style="background:#6366f1;"></span> Replanejamento</span>
        <span class="legenda-item"><span class="legenda-cor" style="background:#f472b6;"></span> Olimp√≠ada</span>
      </div>

      <!-- Bimestres -->
      <div id="cal-ped-bimestres" class="row g-3 mb-4"></div>

      <!-- Grid dos 12 meses -->
      <div id="cal-ped-grid" class="row g-3"></div>

      <!-- Eventos detalhados -->
      <div class="monitor-chart-card mt-4" id="cal-ped-eventos">
        <h6 class="monitor-chart-title"><i class="bi bi-list-stars"></i> Eventos e Datas Importantes</h6>
        <div id="cal-ped-lista-eventos"></div>
      </div>
    </section>

    <!-- TURMAS -->
    <section id="page-turmas" class="page">
      <h2 class="page-title"><i class="bi bi-collection-fill"></i> Turmas</h2>
      <div class="row mb-3">
        <div class="col-md-4">
          <div class="input-group">
            <input type="text" class="form-control" id="input-nova-turma" placeholder="Nome da turma (ex: 6A)" />
            <button class="btn btn-primary" id="btn-criar-turma"><i class="bi bi-plus"></i> Criar</button>
          </div>
        </div>
      </div>
      <div class="row g-3" id="grid-turmas"></div>
    </section>

  </main>
</div>

<!-- MODAL: ALUNO -->
<div class="modal fade" id="modalAluno" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalAlunoTitulo">Novo Aluno</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="form-aluno">
          <input type="hidden" id="aluno-id" />
          <div class="row g-3">
            <div class="col-md-8"><label class="form-label">Nome *</label><input type="text" class="form-control" id="aluno-nome" required /></div>
            <div class="col-md-4"><label class="form-label">Turma</label><select class="form-select" id="aluno-turma"></select></div>
            <div class="col-md-3"><label class="form-label">RA</label><input type="text" class="form-control" id="aluno-ra" /></div>
            <div class="col-md-3"><label class="form-label">Data de Nascimento</label><input type="text" class="form-control" id="aluno-nascimento" placeholder="dd/mm/aaaa" /></div>
            <div class="col-md-3"><label class="form-label">Sexo</label>
              <select class="form-select" id="aluno-sexo"><option value="">Selecione</option><option value="Masculino">Masculino</option><option value="Feminino">Feminino</option></select></div>
            <div class="col-md-3"><label class="form-label">Ra√ßa/Cor</label>
              <select class="form-select" id="aluno-raca"><option value="">Selecione</option><option value="Branca">Branca</option><option value="Preta">Preta</option><option value="Parda">Parda</option><option value="Amarela">Amarela</option><option value="Ind√≠gena">Ind√≠gena</option><option value="N√£o declarada">N√£o declarada</option></select></div>
            <div class="col-md-4"><label class="form-label">CPF</label><input type="text" class="form-control" id="aluno-cpf" /></div>
            <div class="col-md-4"><label class="form-label">Filia√ß√£o 1</label><input type="text" class="form-control" id="aluno-filiacao1" /></div>
            <div class="col-md-4"><label class="form-label">Filia√ß√£o 2</label><input type="text" class="form-control" id="aluno-filiacao2" /></div>
            <div class="col-md-4"><label class="form-label">Telefones</label><input type="text" class="form-control" id="aluno-telefones" /></div>
            <div class="col-md-4"><label class="form-label">E-Mail</label><input type="email" class="form-control" id="aluno-email" /></div>
            <div class="col-md-4"><label class="form-label">CEP</label><input type="text" class="form-control" id="aluno-cep" /></div>
            <div class="col-md-8"><label class="form-label">Endere√ßo</label><input type="text" class="form-control" id="aluno-endereco" /></div>
            <div class="col-md-4"><label class="form-label">Bairro</label><input type="text" class="form-control" id="aluno-bairro" /></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btn-salvar-aluno"><i class="bi bi-check-circle"></i> Salvar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<!-- CHAT IA FLUTUANTE -->
<div id="ia-fab" class="ia-fab" title="Assistente IA">
  <i class="bi bi-robot"></i>
</div>

<div id="ia-panel" class="ia-panel" style="display:none;">
  <div class="ia-panel-header">
    <div class="d-flex align-items-center gap-2">
      <i class="bi bi-robot fs-5"></i>
      <strong>Assistente Pedag√≥gico</strong>
    </div>
    <button class="btn btn-sm btn-outline-light" id="ia-close"><i class="bi bi-x-lg"></i></button>
  </div>
  <div class="ia-panel-body" id="ia-mensagens">
    <div class="ia-msg ia-msg-bot">
      Ol√°! Sou o <strong>Assistente Pedag√≥gico DALMASO</strong>. üéì<br>
      Posso analisar frequ√™ncia, interpretar dados e sugerir interven√ß√µes. Como posso ajudar?
    </div>
  </div>
  <div class="ia-panel-actions mb-2 px-3">
    <button class="btn btn-sm btn-outline-primary ia-quick-btn" data-action="analisar">
      <i class="bi bi-bar-chart"></i> Analisar Frequ√™ncia
    </button>
    <button class="btn btn-sm btn-outline-primary ia-quick-btn" data-action="criticos">
      <i class="bi bi-exclamation-triangle"></i> Alunos Cr√≠ticos
    </button>
  </div>
  <div class="ia-panel-footer">
    <input type="text" class="form-control" id="ia-input" placeholder="Digite sua pergunta..." />
    <button class="btn btn-primary" id="ia-enviar"><i class="bi bi-send-fill"></i></button>
  </div>
</div>

<script src="/js/app.js"></script>
</body>
</html>
